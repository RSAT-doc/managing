<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Jacques van Helden" />

<meta name="date" content="2018-02-01" />

<title>Install organisms from NCBI</title>

<script src="install_organisms_from_ncbi_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="install_organisms_from_ncbi_files/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="install_organisms_from_ncbi_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="install_organisms_from_ncbi_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="install_organisms_from_ncbi_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="install_organisms_from_ncbi_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="install_organisms_from_ncbi_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="install_organisms_from_ncbi_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="install_organisms_from_ncbi_files/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Install organisms from NCBI</h1>
<h4 class="author"><em>Jacques van Helden</em></h4>
<h4 class="date"><em>2018-02-01</em></h4>

</div>


<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>The goal of this tutorial is to explain how to install genomes from NCBI in your RSAT server.</p>
</div>
<div id="prerequisite" class="section level1">
<h1><span class="header-section-number">2</span> Prerequisite</h1>
<p>This protocol assumes that you have a working instance of the RSAT server, and that you are familar with the Unix terminal.</p>
</div>
<div id="protocol" class="section level1">
<h1><span class="header-section-number">3</span> Protocol</h1>
<p>We illustrate the installation procedure with a bacterial genome, since NCBI is the main source of prokaryote genomes for RSAT (<a href="http://prokaryotes.rsat.eu/" class="uri">http://prokaryotes.rsat.eu/</a>). The same procedure can however apply to other taxa, as far as they are available on the NCBI FTP server (<a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/" class="uri">ftp://ftp.ncbi.nlm.nih.gov/genomes/</a>).</p>
<div id="data-source" class="section level2">
<h2><span class="header-section-number">3.1</span> Data source</h2>
<p>Genomes are downloaded from the refseq repository: <a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq" class="uri">ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq</a></p>
</div>
<div id="getting-the-list-of-available-species" class="section level2">
<h2><span class="header-section-number">3.2</span> Getting the list of available species</h2>
<p>The first step to perform with the command <code>ìnstall-organisms</code> is to get the list of organisms available for a given taxonomic group.</p>
<p>The NCBI FTP genome site is organised by “main” <strong>taxonomic groups</strong>:</p>
<ul>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/archaea/">archaea</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/bacteria/">bacteria</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/fungi/">fungi</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/invertebrate/">invertebrate</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/plant/">plant</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/mitochondrion/">mitochondrion</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/plasmid">plasmid</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/plastid">plastid</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/protozoa/">protozoa</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/vertebrate_mammalian/">vertebrate_mammalian</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/vertebrate_other/">vertebrate_other</a></li>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/viral/">viral</a></li>
</ul>
<p>The option <code>-task available</code> returns the complete list of available species for the specified group.</p>
<p>The command below gets the list of all available bacteria and stores them in a text file. It can easily be adapted to another group by changing the environment variable <code>GROUP</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">## Get curret date to use as suffix for output files</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="bu">export</span> <span class="va">TODAY=</span><span class="kw">`</span><span class="fu">date</span> +%Y-%m-%d<span class="kw">`</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">## Choose a taxonomic group of interest</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="bu">export</span> <span class="va">GROUP=</span>bacteria</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">## Get the list of bacterial species available on the NCBI FTP site</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="ex">install-organism</span> -v 1 -group <span class="va">${GROUP}</span> -task available \</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  -o available_<span class="va">${GROUP}</span>_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">## Count the number of species.</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">## Note: grep is used to filter out the comment lines.</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="fu">grep</span> -v <span class="st">&#39;^;&#39;</span> available_<span class="va">${GROUP}</span>_<span class="va">${TODAY}</span>.txt <span class="kw">|</span> <span class="fu">wc</span> -l</a></code></pre></div>
<p>We can of course do the same for other taxa, for example Archaea, Fungi or Mammalian.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="bu">export</span> <span class="va">TAXA=</span><span class="st">&#39;archaea bacteria fungi invertebrate</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">plant mitochondrion plasmid plastid protozoa</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">vertebrate_mammalian vertebrate_other viral&#39;</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">for</span> <span class="ex">taxon</span> in <span class="va">$TAXA</span><span class="kw">;</span> <span class="kw">do</span> <span class="kw">\</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="bu">echo</span> <span class="st">&quot;Getting list of NCBI species for </span><span class="va">${taxon}</span><span class="st">&quot;</span> <span class="kw">;</span> <span class="kw">\</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="ex">install-organism</span> -v 1 -group <span class="va">${taxon}</span> -task available \</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  -o available_<span class="va">${taxon}</span>_<span class="va">${TODAY}</span>.txt <span class="kw">;</span> <span class="kw">\</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw">done</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">## Approx count of species per taxa</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">## (each file starts with 15 comment lines, which are be substracted from each count)</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="fu">wc</span> -l available_*_<span class="va">${TODAY}</span>.txt <span class="kw">|</span>  <span class="fu">sort</span> -nr  <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print &quot;|\t&quot;$1-15&quot;\t| &quot;$2&quot;\t|&quot;}&#39;</span> </a></code></pre></div>
<div id="number-of-species-per-group" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Number of species per group</h3>
<p>Here is the result on Dec 12, 2017.</p>
<table>
<thead>
<tr class="header">
<th>Number of species</th>
<th>Taxonomic group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>25626</td>
<td>total</td>
</tr>
<tr class="even">
<td>16735</td>
<td>available_bacteria_2017-12-12.txt</td>
</tr>
<tr class="odd">
<td>7384</td>
<td>available_viral_2017-12-12.txt</td>
</tr>
<tr class="even">
<td>531</td>
<td>available_archaea_2017-12-12.txt</td>
</tr>
<tr class="odd">
<td>245</td>
<td>available_fungi_2017-12-12.txt</td>
</tr>
<tr class="even">
<td>155</td>
<td>available_invertebrate_2017-12-12.txt</td>
</tr>
<tr class="odd">
<td>124</td>
<td>available_vertebrate_other_2017-12-12.txt</td>
</tr>
<tr class="even">
<td>109</td>
<td>available_vertebrate_mammalian_2017-12-12.txt</td>
</tr>
<tr class="odd">
<td>99</td>
<td>available_plant_2017-12-12.txt</td>
</tr>
<tr class="even">
<td>79</td>
<td>available_protozoa_2017-12-12.txt</td>
</tr>
<tr class="odd">
<td>0</td>
<td>available_plastid_2017-12-12.txt</td>
</tr>
<tr class="even">
<td>0</td>
<td>available_plasmid_2017-12-12.txt</td>
</tr>
<tr class="odd">
<td>0</td>
<td>available_mitochondrion_2017-12-12.txt</td>
</tr>
</tbody>
</table>
<p><strong>Notes</strong></p>
<ul>
<li><p>The <strong>number of available genomes</strong> exceeds by far the number of species, because some species are represented by different strains, in particular for bacteria (for some bacterial species of interest for health, several thousands of strains have been sequenced).</p></li>
<li><p>Some of these genomes are only partly sequenced, or poorly assembled, and the level of annotation is quite variable. NCBI subdivided these available genomes in 4 categories depending on the level of completion of the sequencing project.</p></li>
</ul>
</div>
</div>
<div id="installing-the-genome-for-a-given-species" class="section level2">
<h2><span class="header-section-number">3.3</span> Installing the genome for a given species</h2>
<div id="download-the-genomes" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Download the genome(s)</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">## Select a species and straint of interest </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">## (can be adapted to your needs)</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="bu">export</span> <span class="va">SPECIES=</span>Rhodospirillum_centenum</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="bu">export</span> <span class="va">STRAIN=</span>GCF_000016185.1_ASM1618v1</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="bu">export</span> <span class="va">TAXON=</span>Rhodospirillum</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">## An example of altrnative set of parameters</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># export SPECIES=Rhizobium_etli</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co"># export STRAIN=GCF_000092045.1_ASM9204v1</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co"># export TAXON=Rhizobiales</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">## Download the genome(s) for a given species </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">## (e.g. Rhodospirillum_centenum)  </span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="ex">install-organism</span> -v 1 -group bacteria \</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  -species <span class="va">${SPECIES}</span> \</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">  -task download,list</a></code></pre></div>
<p><strong>Notes</strong></p>
<ol style="list-style-type: decimal">
<li><p>The option <code>-species</code> requires to specify the Genus (with a leading uppercase) and species (in lowercases) separated by an undescore character (<code>_</code>), with exactly the same spelling and cases as on the NCBI FTP refseq site.</p></li>
<li><p>Downloaded genomes will be installed in a folder <code>$RSAT/downloads/refseq</code> on your computer. Each strain is stored in a separate folder, with the same organistion as on the NCBI FTP site.</p></li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">ls <span class="dv">-1</span> <span class="op">$</span>RSAT<span class="op">/</span>downloads<span class="op">/</span>refseq<span class="op">/</span>bacteria<span class="op">/</span><span class="er">$</span>{SPECIES}<span class="op">/</span>latest_assembly_versions</a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>Beware:</strong> for some bacterial species of particular interest (e.g. important human pathogens), severak thousands of strains have been sequenced. It might cost a lot of time and disk space to download all of them. TO avoid that, the option <code>-strain</code> enables to specify the full strain name (more precisely the subfolder corresponding to the strain of interest in the species folder on the NCBI FTP site).</li>
</ol>
</div>
<div id="listing-the-available-strains-for-the-species-of-interest" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Listing the available strains for the species of interest</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## List the available strains for a given species (e.g. Rhodospirillum centenum).</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="ex">install-organism</span> -v 1 -group bacteria \</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  -species <span class="va">${SPECIES}</span> \</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  -task list</a></code></pre></div>
<p>This command actually lists the folders.</p>
</div>
<div id="parsing-the-genomes" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Parsing the genomes</h3>
<p>Parsing consists in extracting the information from a text-formatted file, in order to organise it in a computable structure.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">## Parse a given strain of a given genome </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">## (e.g. strain GCF_000016185.1_ASM1618v1 of Rhodospirillum centenum) </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="ex">install-organism</span> -v 2 -group bacteria \</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  -species <span class="va">${SPECIES}</span> \</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  -strain <span class="va">${STRAIN}</span> \</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  -task parse</a></code></pre></div>
<p><strong>Note:</strong> if the option <code>-strain</code> is omitted, <code>install-organisms</code> parses all the strains found in the download folder of the selected organism.</p>
<p>For each parsed genome, the program creates a folder whose name is the concatenation of the genus, species and strain names: <code>$RSAT/public_html/data/[Genus_species_strain]</code></p>
<p>From now on we will directly refer to this concatenated name as the “Organism name” (generally denoted by the option <code>-org</code> in RSAT commands.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">## Check the parsing result</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="fu">ls</span> -l <span class="va">${RSAT}</span>/public_html/data/genomes/<span class="va">${SPECIES}</span>_<span class="va">${STRAIN}</span>/genome/</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">## Measure the disk space occupied by this genome (note: this will be increased in the subsequent steps)</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="fu">du</span> -sm <span class="va">${RSAT}</span>/public_html/data/genomes/<span class="va">${SPECIES}</span>_<span class="va">${STRAIN}</span>/genome/</a></code></pre></div>
<p>This gives the number of megabases occupied by the genome folder.</p>
</div>
<div id="adding-the-parsed-genome-to-the-list-of-supported-genomes" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Adding the parsed genome to the list of supported genomes</h3>
<p>In order to make the parsed genome available for RSAT, you need to run the configuration task.</p>
<p>Note that for the subsequent tasks, the options <code>-species</code> and <code>-strains</code> are not used anymore, we will instead specify “organisms” installed on RSAT, identified by the concatenation of Genus, species and strain.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">## Configure the organism for RSAT</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="ex">install-organism</span> -v 1 -org <span class="va">${SPECIES}</span>_<span class="va">${STRAIN}</span> -task config</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">## Check that the organism has weel been declared</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="ex">supported-organisms</span> -taxon <span class="va">${TAXON}</span></a></code></pre></div>
</div>
<div id="finalizing-the-installation" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Finalizing the installation</h3>
<p>Several more tasks need to be performed before we can consider this organism as “installed”.</p>
<p>The simplest way to run it is to select the “default” tasks.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">## Run the installation task (retrieve upstream sequences compute background oligo and dyad frequencies, index fasta genome for bedtols, ...)</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="ex">install-organism</span> -v 1 -org <span class="va">${SPECIES}</span>_<span class="va">${STRAIN}</span> -task default</a></code></pre></div>
<div id="detailed-list-of-supported-installation-tasks-default-and-others" class="section level4">
<h4><span class="header-section-number">3.3.5.1</span> Detailed list of supported installation tasks (default and others)</h4>
<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>default</td>
<td>run all the default tasks useful for the installation of a genome (this is a subset of the tasks specified below)</td>
</tr>
<tr class="even">
<td>start_stop</td>
<td>compute trinucleotide frequencies in all the start and stop codons (validation of the correspondance between genome sequences and gene coordinates)</td>
</tr>
<tr class="odd">
<td>allup</td>
<td>Retrieve all upstream sequences in order to compute the background models (oligonucleotide and dyad frequencies)</td>
</tr>
<tr class="even">
<td>seq_len_distrib</td>
<td>Compute the distribution of upstream sequences</td>
</tr>
<tr class="odd">
<td>genome_segments</td>
<td>SPlit the genome into segments corresponding to different genomic region types: genic, intergenic, …</td>
</tr>
<tr class="even">
<td>upstream_freq</td>
<td>Compute oligonucleotide or/and dyad frequencies in upstream sequences (must be combined with tasks oligos and/or dyads)</td>
</tr>
<tr class="odd">
<td>genome_freq</td>
<td>Compute oligonucleotide or/and dyad frequencies in the whole genome (must be combined with tasks oligos and/or dyads)</td>
</tr>
<tr class="even">
<td>protein_freq</td>
<td>Compute amino acid, di- and tri-peptide frequencies in all protein sequences</td>
</tr>
<tr class="odd">
<td>protein_len</td>
<td>Compute distribution of protein lengths</td>
</tr>
<tr class="even">
<td>oligos</td>
<td>Compute oligonucleotide frequencies (size 1 to 8) in a given type of sequences. Must be combined with stasks upstream or genomic</td>
</tr>
<tr class="odd">
<td>dyads</td>
<td>Idem for dyads, i.e. spaced pairs of trinucleotides</td>
</tr>
<tr class="even">
<td>fasta_genome</td>
<td>convert genome sequence in fasta in order to make it usable by bedtools</td>
</tr>
<tr class="odd">
<td>chrom_sizes</td>
<td>compute chromosome sizes from genomic sequences</td>
</tr>
<tr class="even">
<td>index_bedtools</td>
<td>index genome to enable its ultra-fast processing by bedtools</td>
</tr>
<tr class="odd">
<td>uninstall</td>
<td>uninstall a genome, i.e. stop displaying it as available. Beware, this does not erase the genome folder, for this you can use the option <code>-task erase</code></td>
</tr>
<tr class="even">
<td>erase</td>
<td>Erase the whole folder of your organism in <code>$RSAT/public_html/data</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="checking-that-the-organism-is-well-supported" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Checking that the organism is well supported</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">## Get all the organisms of the Genus Rhodospirillum</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="ex">supported-organisms</span> -taxon <span class="va">${TAXON}</span></a></code></pre></div>
</div>
<div id="checking-the-correctness-of-gene-annotations-by-computing-startstop-codon-frequencies" class="section level3">
<h3><span class="header-section-number">3.3.7</span> Checking the correctness of gene annotations by computing start/stop codon frequencies</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">## Retrieve all the start codon sequences</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="ex">retrieve-seq</span> -all -org <span class="va">${SPECIES}</span>_<span class="va">${STRAIN}</span> -from 0 -to 2 -o start_seq.fasta</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="fu">more</span> start_seq.fasta</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">## Check that most genes have ATG as start codon</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="ex">oligo-analysis</span> -v 1 -i start_seq.fasta  -l 3 -1str -return occ,freq -sort <span class="kw">|</span> <span class="fu">more</span></a></code></pre></div>
<p>You can do the similar test with the stop codon frequencies. Note that nothing forces you to store the stop codong sequences in a local file, you can use the pipe symbol <code>|</code> to concatenate two commands.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## Compute all trinucleotide frequencies in the stop codons</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ex">retrieve-seq</span> -all -org <span class="va">${SPECIES}</span>_<span class="va">${STRAIN}</span> \</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">   -type downstream -from -1 -to -3 -o stop_seq.fasta</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="fu">more</span> stop_seq.fasta</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">## Check that most genes have ATG as start codon</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="ex">oligo-analysis</span> -v 1 -i stop_seq.fasta  -l 3 -1str \</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">   -return occ,freq -sort <span class="kw">|</span> <span class="fu">more</span></a></code></pre></div>
<hr />
</div>
</div>
<div id="selecting-organisms-with-complete-genomes-or-chromosomes" class="section level2">
<h2><span class="header-section-number">3.4</span> Selecting organisms with Complete genomes or Chromosomes</h2>
<p>For each taxonomic group, NCBI provides a summary file with indications of the sequencing status for each genome project. Here is the link for Bacteria (you can easily adapt it for other groups).</p>
<ul>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/bacteria/assembly_summary.txt" class="uri">ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/bacteria/assembly_summary.txt</a></li>
</ul>
<p>This table contains many columns with valuable information for genome management. The column contain is indicated in a separate file.</p>
<ul>
<li><a href="ftp://ftp.ncbi.nlm.nih.gov/genomes/README_assembly_summary.txt" class="uri">ftp://ftp.ncbi.nlm.nih.gov/genomes/README_assembly_summary.txt</a></li>
</ul>
<p>Genome assemblies are classigied in four levels (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4702866/">PMCID: PMC4702866</a>).</p>
<ol style="list-style-type: decimal">
<li><strong>Contig:</strong> Assemblies that include only contigs.</li>
<li><strong>Scaffold:</strong> Includes both scaffolds and contigs.</li>
<li><strong>Chromosome:</strong> Includes chromosome or linkage groups, plus scaffolds and contigs.</li>
<li><strong>Complete genome:</strong> Assemblies for which all molecules are fully sequenced.</li>
</ol>
<p>We can use this assembly summary to select only those genomes with the a completion level that we consider appropriate.</p>
<p>For example, for the RSAT prokaryote server (<a href="http://prokaryote.rsat.eu" class="uri">http://prokaryote.rsat.eu</a>), we restrict the installation to genomes with at least one fully sequenced chromosome (categories “Chromosome” and “Complete Genome”).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">## Get curret date to use as suffix for output files</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="bu">export</span> <span class="va">TODAY=</span><span class="kw">`</span><span class="fu">date</span> +%Y-%m-%d<span class="kw">`</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">## Choose a taxonomic group of interest</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="bu">export</span> <span class="va">GROUP=</span>bacteria</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">## Set a file name for the assembly file</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="va">ASSEMBLY_URL=</span>ftp://ftp.ncbi.nlm.nih.gov/genomes/refseq/<span class="va">${GROUP}</span>/assembly_summary.txt</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="va">ASSEMBLY=</span>ncbi_organisms_assembly_summary_<span class="va">${GROUP}</span>_refseq_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="va">COMPLETE=</span>ncbi_organisms_assembly_summary_<span class="va">${GROUP}</span>_complete_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="va">ONECHROM=</span>ncbi_organisms_assembly_summary_<span class="va">${GROUP}</span>_chromosome_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="va">ONECHROM_AND_COMPLETE=</span>chromosome_and_complete_<span class="va">${GROUP}</span>l_genomes_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb13-13" data-line-number="13"></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">## Dowload the assembly summary from NCBI FTP site</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="fu">wget</span> -nc <span class="va">${ASSEMBLY_URL}</span> --output-document <span class="va">${ASSEMBLY}</span> </a>
<a class="sourceLine" id="cb13-16" data-line-number="16"></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">## Count the number of organisms (remove comments first) </span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="fu">grep</span> -v <span class="st">&#39;^#&#39;</span> <span class="va">${ASSEMBLY}</span> <span class="kw">|</span> <span class="fu">wc</span> -l</a>
<a class="sourceLine" id="cb13-19" data-line-number="19"></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">## Select only the genomes with a Complete or Chromosome annotation in the field assembly_level</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="fu">awk</span> -F <span class="st">&quot;\t&quot;</span> <span class="st">&#39;$12==&quot;Chromosome&quot; &amp;&amp; $11==&quot;latest&quot;{print $0}&#39;</span> \</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">      <span class="va">${ASSEMBLY}</span> \</a>
<a class="sourceLine" id="cb13-23" data-line-number="23">      <span class="op">&gt;</span> <span class="va">${ONECHROM}</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24">      </a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="fu">awk</span> -F <span class="st">&quot;\t&quot;</span> <span class="st">&#39;$12==&quot;Complete Genome&quot; &amp;&amp; $11==&quot;latest&quot;{print $0}&#39;</span> \</a>
<a class="sourceLine" id="cb13-26" data-line-number="26">      <span class="va">${ASSEMBLY}</span> \</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">      <span class="op">&gt;</span> <span class="va">${COMPLETE}</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">## Merge summary tables of species with at least one sequenced chromosome</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="fu">cat</span> <span class="va">${COMPLETE}</span> <span class="va">${ONECHROM}</span> <span class="op">&gt;</span>  <span class="va">${ONECHROM_AND_COMPLETE}</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">## Count the number of selected species</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="fu">wc</span> -l <span class="va">${COMPLETE}</span> <span class="va">${ONECHROM}</span> <span class="va">${ONECHROM_AND_COMPLETE}</span> <span class="va">${ASSEMBLY}</span> </a></code></pre></div>
<p>The assembly summary also contains information about the status of the genome for the biologist community, with three possible statuses: <em>reference genome</em>, <em>representative genome</em>, or <em>na</em> (non attributed).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="va">REFERENCE=</span>ncbi_organisms_assembly_summary_<span class="va">${GROUP}</span>_reference_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="va">REPRESENTATIVE=</span>ncbi_organisms_assembly_summary_<span class="va">${GROUP}</span>_representative_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="va">REPRESENTATIVE_COMPLETE=</span>ncbi_organisms_assembly_summary_<span class="va">${GROUP}</span>_representative_complete_<span class="va">${TODAY}</span>.txt</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">## Select reference genomes</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="fu">awk</span> -F <span class="st">&quot;\t&quot;</span> <span class="st">&#39;$5==&quot;reference genome&quot; &amp;&amp; $11==&quot;latest&quot;{print $0}&#39;</span> \</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">      <span class="va">${ASSEMBLY}</span> \</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">      <span class="op">&gt;</span> <span class="va">${REFERENCE}</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">## Select representative genomes</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="fu">awk</span> -F <span class="st">&quot;\t&quot;</span> <span class="st">&#39;$5==&quot;representative genome&quot; &amp;&amp; $11==&quot;latest&quot;{print $0}&#39;</span> \</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">      <span class="va">${ASSEMBLY}</span> \</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">      <span class="op">&gt;</span> <span class="va">${REPRESENTATIVE}</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">## Select representative and complete genomes</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="fu">awk</span> -F <span class="st">&quot;\t&quot;</span> <span class="st">&#39;$5==&quot;representative genome&quot; &amp;&amp; $12==&quot;Complete Genome&quot;  &amp;&amp; $11==&quot;latest&quot;{print $0}&#39;</span> \</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">      <span class="va">${ASSEMBLY}</span> \</a>
<a class="sourceLine" id="cb14-19" data-line-number="19">      <span class="op">&gt;</span> <span class="va">${REPRESENTATIVE_COMPLETE}</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">## Print the umbers of reference or representative genomes</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="fu">wc</span> -l <span class="va">${REFERENCE}</span> <span class="va">${REPRESENTATIVE_COMPLETE}</span> <span class="va">${REPRESENTATIVE}</span> <span class="va">${COMPLETE}</span> <span class="va">${ONECHROM}</span> <span class="va">${ONECHROM_AND_COMPLETE}</span> <span class="va">${ASSEMBLY}</span> </a></code></pre></div>
<hr />
</div>
<div id="installing-many-genomes" class="section level2">
<h2><span class="header-section-number">3.5</span> Installing many genomes</h2>
<p>We can install multiple species in a single command by specifying a file containing a list of species names (one species name per row).</p>
<p><strong>Beware</strong>:</p>
<ul>
<li>This tan take a considerable time dependingon the number of selected species and bandwidth of your computer.</li>
<li>This command will download thousands of genomes on your hard drive, which will undoubtedly occupy some disj space.</li>
</ul>
<div id="downloading-genome-files-from-ncbi" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Downloading genome files from NCBI</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">## File with the list of species to install</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="va">SPECIES_TO_INSTALL=${GROUP}</span>_to_install.txt</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">## Get the two first words of the 8th column as Genus and species names</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="fu">cut</span> -f 8 <span class="va">${ONECHROM_AND_COMPLETE}</span> \</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1&quot;_&quot;$2}&#39;</span> \</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">   <span class="op">&gt;</span> <span class="va">${SPECIES_TO_INSTALL}</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="fu">wc</span> -l <span class="va">${SPECIES_TO_INSTALL}</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">## Download all the selected species</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="ex">install-organism</span> -v 2 -group <span class="va">${GROUP}</span> \</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">   -species_file <span class="va">${SPECIES_TO_INSTALL}</span> -task download</a></code></pre></div>
</div>
<div id="parsing-genomes-from-ncbi-files" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Parsing genomes from NCBI files</h3>
</div>
<div id="rsat-installation" class="section level3">
<h3><span class="header-section-number">3.5.3</span> RSAT installation</h3>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
